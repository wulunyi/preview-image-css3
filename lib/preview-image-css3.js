(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("alloyfinger"),require("css3transform")):"function"==typeof define&&define.amd?define("PreviewImageCss",["alloyfinger","css3transform"],t):"object"==typeof exports?exports.PreviewImageCss=t(require("alloyfinger"),require("css3transform")):e.PreviewImageCss=t(e.alloyfinger,e.css3transform)})(this,function(e,t){return function(e){function t(m){if(n[m])return n[m].exports;var a=n[m]={i:m,l:!1,exports:{}};return e[m].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,m){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:m})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){"use strict";function m(e,t){return e/t>=1?1:-1}function a(e,t,n,m,r){return a[r+""].apply(null,arguments)}function r(e,t,n,m){return(t-e)*m+e+n}function i(e,t,n){var m=e*n;return m<=t?{min:(t-m)/2,max:(t-m)/2}:{min:t-m,max:0}}function o(e,t,n,m,a){var o=r(t/2,n,m,a),f=i(e,t,a),s=!1;return f.min===f.max?s=0:f.min>o?s=f.min-o+m:f.max<o&&(s=f.max-o+m),s}function f(e,t,n,m,a,r){var i=t-e,o=n-e,f=(o-0)*r+0,s=(o-i)*r+i,l=s-f,u=s+e,c=m*r,g=0,b=a-c;return c<=a?l=0:(u>g&&(l=g-e-f),u<b&&(l=b-e-f)),l}Object.defineProperty(t,"__esModule",{value:!0}),a[1]=function(e,t,n,m){return{w:e,h:m*e/n}},a[-1]=function(e,t,n,m){return{h:t,w:n*t/m}},t.judgeShape=m,t.transformWH=a,t.calculateOffset=f,t.calculatePoint=r,t.calculagteRange=i,t.checkPlace=o},function(e,t,n){"use strict";var m=document.createElement("style");m.innerHTML="\n.loader {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n\n  margin: auto;\n  font-size: 25px;/*px*/\n  width: 1em;\n  height: 1em;\n  border-radius: 50%;\n  \n  text-indent: -9999em;\n  -webkit-animation: load5 1.1s infinite ease;\n  animation: load5 1.1s infinite ease;\n  -webkit-transform: translateZ(0);\n  -ms-transform: translateZ(0);\n  transform: translateZ(0);\n}\n\n@-webkit-keyframes load5 {\n  0%,\n  100% {\n    box-shadow: 0em -2.6em 0em 0em #ffffff, 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.5), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);\n  }\n  12.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7), 1.8em -1.8em 0 0em #ffffff, 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);\n  }\n  25% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7), 2.5em 0em 0 0em #ffffff, 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  37.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5), 2.5em 0em 0 0em rgba(255, 255, 255, 0.7), 1.75em 1.75em 0 0em #ffffff, 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  50% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.5), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7), 0em 2.5em 0 0em #ffffff, -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  62.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5), 0em 2.5em 0 0em rgba(255, 255, 255, 0.7), -1.8em 1.8em 0 0em #ffffff, -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  75% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.5), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7), -2.6em 0em 0 0em #ffffff, -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  87.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5), -2.6em 0em 0 0em rgba(255, 255, 255, 0.7), -1.8em -1.8em 0 0em #ffffff;\n  }\n}\n\n@keyframes load5 {\n  0%,\n  100% {\n    box-shadow: 0em -2.6em 0em 0em #ffffff, 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.5), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);\n  }\n  12.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7), 1.8em -1.8em 0 0em #ffffff, 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);\n  }\n  25% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7), 2.5em 0em 0 0em #ffffff, 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  37.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5), 2.5em 0em 0 0em rgba(255, 255, 255, 0.7), 1.75em 1.75em 0 0em #ffffff, 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  50% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.5), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7), 0em 2.5em 0 0em #ffffff, -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  62.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5), 0em 2.5em 0 0em rgba(255, 255, 255, 0.7), -1.8em 1.8em 0 0em #ffffff, -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  75% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.5), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7), -2.6em 0em 0 0em #ffffff, -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  87.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5), -2.6em 0em 0 0em rgba(255, 255, 255, 0.7), -1.8em -1.8em 0 0em #ffffff;\n  }\n}\n\n.pr__load--err{\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n\n  margin: auto;\n\n  height: 1.2em;\n  line-height: 1.2em;\n  font-size: 1.6em;/*px*/\n  text-align: center;\n\n  color: #ffffff;\n}\n",document.head.appendChild(m)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),m=Math.max(0,16-(n-e)),a=window.setTimeout(function(){t(n+m)},m);return e=n+m,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var m=function e(t,n,m,a,r,i,o){var f=t[n],s=m-f,l=new Date,u=this,c=r||function(e){return e};this.tickID=null,function e(){var r=new Date-l;if(r>=a)return t[n]=m,o&&o(m),i&&i(m),cancelAnimationFrame(u.tickID),void(u.toTick=null);t[n]=s*c(r/a)+f,u.tickID=requestAnimationFrame(e),o&&o(t[n])}(),e.List.push(this)};m.List=[],m.stopAll=function(){for(var e=0,t=m.List.length;e<t;e++)cancelAnimationFrame(m.List[e].tickID);m.List.length=0},m.stop=function(e){cancelAnimationFrame(e.tickID)},t.default=m},function(e,t,n){"use strict";function m(e){return"object"===("undefined"==typeof HTMLElement?"undefined":f(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":f(e))&&1===e.nodeType&&"string"==typeof e.nodeName}function a(e,t){if("object"===(void 0===t?"undefined":f(t)))for(var n in t)e.style[n]=t[n]}function r(e){var t=document.createElement("img");return t.addEventListener("load",function(e){r.AFTER_HOOK&&r.AFTER_HOOK(null,t),r.AFTER_HOOK=null}),t.addEventListener("error",function(e){var n=new Error("图片加载失败");r.AFTER_HOOK&&r.AFTER_HOOK(n,t),r.AFTER_HOOK=null}),t.src=e,r}function i(e,t,n){var r=document.createElement(e);return t&&a(r,t),n&&m(n)&&r.appendChild(n),r}function o(e){return Math.sqrt(1-Math.pow(e-1,2))}Object.defineProperty(t,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.after=function(e){r.AFTER_HOOK=e},t.isDom=m,t.setStyle=a,t.pullImage=r,t.createElement=i,t.ease=o},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var m=t[n];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(e,m.key,m)}}return function(t,n,m){return n&&e(t.prototype,n),m&&e(t,m),t}}(),o=n(4),f=a(o),s=n(5),l=a(s),u=n(3),c=m(u),g=n(2),b=a(g),d=n(0),h=m(d);n(1);var p={imageSrc:"",doubleZoom:2,maxZoom:4,minZoom:1,softX:!0,softY:!0},w=function(){function e(t,n){r(this,e),c.isDom(t)&&(this.options=n||{},this.context=t,this.conBox=t.getBoundingClientRect(),this.callList=[],c.setStyle(this.context,{position:"relative"}))}return i(e,[{key:"start",value:function(){var e=this;this.loading("start"),c.pullImage(this.options.imageSrc).after(function(t,n){if(e.loading("end"),t)return void e.err();for(e.init(n);e.callList.length;)e.callList.shift()()})}},{key:"init",value:function(e){if(e){var t=h.judgeShape(e.width,e.height),n=h.transformWH(this.context.clientWidth,this.context.clientHeight,e.width,e.height,t),m=n.w,a=n.h,r=t===-1?0:this.context.clientHeight/2-a/2,i=1===t?0:this.context.clientWidth/2-m/2;c.setStyle(e,{position:"absolute",width:m+"px",height:a+"px",top:r+"px",left:i+"px"}),this.element=e,this.elBox=this.element.getBoundingClientRect(),this.leftPx=i,this.topPx=r,(0,l.default)(this.element),this.bind()}}},{key:"loading",value:function(e){"start"===e&&(this.loadingDom||(this.loadingDom=document.createElement("div"),this.loadingDom.className="loader"),this.context.appendChild(this.loadingDom)),"end"===e&&this.context.removeChild(this.loadingDom)}},{key:"err",value:function(){this.errDom||(this.errDom=document.createElement("p"),this.errDom.className="pr__load--err",this.errDom.innerHTML="图片加载失败"),this.context.appendChild(this.errDom)}},{key:"bind",value:function(){var e=this;if(!this.element)return void this.callList.push(function(){e.bind()});this.gesture&&this.unbind();var t=this.element,n=this.options.minZoom,m=this.options.maxZoom,a=this.elBox,r=this.conBox,i=this,o=this.leftPx,s=this.topPx,l=c.ease,u=1,g=!1;this.gesture=new f.default(this.context,{multipointStart:function(){b.default.stopAll(),u=t.scaleX},pinch:function(e){t.scaleX=t.scaleY=u*e.scale},multipointEnd:function(){t.scaleX<n&&(new b.default(t,"scaleX",n,500,l),new b.default(t,"scaleY",n,500,l)),t.scaleX>m&&(new b.default(t,"scaleX",m,500,l),new b.default(t,"scaleY",m,500,l))},pressMove:function(e){b.default.stopAll(),g=!0;var n=i.options.softX,m=i.options.softY;if(n)t.translateX+=e.deltaX;else{h.checkPlace(a.width,r.width,o,t.translateX+e.deltaX,t.scaleX)===!1&&(t.translateX+=e.deltaX)}if(m)t.translateY+=e.deltaY;else{h.checkPlace(a.height,r.height,s,t.translateY,t.scaleY)===!1&&(t.translateY+=e.deltaY)}e.preventDefault()},touchEnd:function(){if(g){var e=h.checkPlace(a.height,r.height,s,t.translateY,t.scaleY),n=h.checkPlace(a.width,r.width,o,t.translateX,t.scaleX);e!==!1&&new b.default(t,"translateY",e,400,l),n!==!1&&new b.default(t,"translateX",n,400,l)}g=!1},doubleTap:function(e){b.default.stopAll();var m=i.options.doubleZoom,f=(n+m)/2,u=400;if(t.scaleX>f)new b.default(t,"scaleX",n,u,l),new b.default(t,"scaleY",n,u,l),new b.default(t,"translateX",0,u,l),new b.default(t,"translateY",0,u,l);else{var c=r.width/2,g=r.height/2,d=[e.changedTouches[0].pageX,e.changedTouches[0].pageY],p=d[0],w=d[1],x=h.calculateOffset(c,p,o,a.width,r.width,m),v=h.calculateOffset(g,w,s,a.height,r.height,m);new b.default(t,"scaleX",m,u,l),new b.default(t,"scaleY",m,u,l),new b.default(t,"translateX",x,u,l),new b.default(t,"translateY",v,u,l)}}})}},{key:"unbind",value:function(){var e=this;if(!this.element)return void this.callList.push(function(){e.unbind()});this.gesture=this.gesture.destroy()}},{key:"options",get:function(){return this._options},set:function(e){this._options=Object.assign(p,e)}},{key:"element",get:function(){return this._element},set:function(e){this._element||(this._element=e,this.context.appendChild(this.element))}}]),e}();t.default=w}])});