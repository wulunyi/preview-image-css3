(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("alloyfinger"),require("css3transform")):"function"==typeof define&&define.amd?define("PreviewImageCss",["alloyfinger","css3transform"],t):"object"==typeof exports?exports.PreviewImageCss=t(require("alloyfinger"),require("css3transform")):e.PreviewImageCss=t(e.alloyfinger,e.css3transform)})(this,function(e,t){return function(e){function t(m){if(n[m])return n[m].exports;var a=n[m]={i:m,l:!1,exports:{}};return e[m].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,m){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:m})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){"use strict";function m(e,t){return e/t>=1?1:-1}function a(e,t,n,m,r){return a[r+""].apply(null,arguments)}function r(e,t,n,m){return(t-e)*m+e+n}function o(e,t,n){var m=e*n;return m<=t?{min:(t-m)/2,max:(t-m)/2}:{min:t-m,max:0}}function i(e,t,n,m,a){var i=r(t/2,n,m,a),f=o(e,t,a),s=!1;return f.min===f.max?s=0:f.min>i?s=f.min-i+m:f.max<i&&(s=f.max-i+m),s}function f(e,t,n,m,a,r){var o=t-e,i=n-e,f=(i-0)*r+0,s=(i-o)*r+o,l=s-f,u=s+e,c=m*r,b=0,d=a-c;return c<=a?l=0:(u>b&&(l=b-e-f),u<d&&(l=d-e-f)),l}Object.defineProperty(t,"__esModule",{value:!0}),a[1]=function(e,t,n,m){return{w:e,h:m*e/n}},a[-1]=function(e,t,n,m){return{h:t,w:n*t/m}},t.judgeShape=m,t.transformWH=a,t.calculateOffset=f,t.calculatePoint=r,t.calculagteRange=o,t.checkPlace=i},function(e,t,n){"use strict";var m=document.createElement("style");m.innerHTML="\n.loader {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n\n  margin: auto;\n  font-size: 25px;/*px*/\n  width: 1em;\n  height: 1em;\n  border-radius: 50%;\n  \n  text-indent: -9999em;\n  -webkit-animation: load5 1.1s infinite ease;\n  animation: load5 1.1s infinite ease;\n  -webkit-transform: translateZ(0);\n  -ms-transform: translateZ(0);\n  transform: translateZ(0);\n}\n\n@-webkit-keyframes load5 {\n  0%,\n  100% {\n    box-shadow: 0em -2.6em 0em 0em #ffffff, 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.5), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);\n  }\n  12.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7), 1.8em -1.8em 0 0em #ffffff, 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);\n  }\n  25% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7), 2.5em 0em 0 0em #ffffff, 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  37.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5), 2.5em 0em 0 0em rgba(255, 255, 255, 0.7), 1.75em 1.75em 0 0em #ffffff, 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  50% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.5), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7), 0em 2.5em 0 0em #ffffff, -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  62.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5), 0em 2.5em 0 0em rgba(255, 255, 255, 0.7), -1.8em 1.8em 0 0em #ffffff, -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  75% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.5), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7), -2.6em 0em 0 0em #ffffff, -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  87.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5), -2.6em 0em 0 0em rgba(255, 255, 255, 0.7), -1.8em -1.8em 0 0em #ffffff;\n  }\n}\n\n@keyframes load5 {\n  0%,\n  100% {\n    box-shadow: 0em -2.6em 0em 0em #ffffff, 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.5), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);\n  }\n  12.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7), 1.8em -1.8em 0 0em #ffffff, 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);\n  }\n  25% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7), 2.5em 0em 0 0em #ffffff, 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  37.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5), 2.5em 0em 0 0em rgba(255, 255, 255, 0.7), 1.75em 1.75em 0 0em #ffffff, 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  50% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.5), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7), 0em 2.5em 0 0em #ffffff, -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2), -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  62.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5), 0em 2.5em 0 0em rgba(255, 255, 255, 0.7), -1.8em 1.8em 0 0em #ffffff, -2.6em 0em 0 0em rgba(255, 255, 255, 0.2), -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  75% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.5), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7), -2.6em 0em 0 0em #ffffff, -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);\n  }\n  87.5% {\n    box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2), 1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2), 2.5em 0em 0 0em rgba(255, 255, 255, 0.2), 1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2), 0em 2.5em 0 0em rgba(255, 255, 255, 0.2), -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5), -2.6em 0em 0 0em rgba(255, 255, 255, 0.7), -1.8em -1.8em 0 0em #ffffff;\n  }\n}\n\n.pr__load--err{\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n\n  margin: auto;\n\n  height: 1.2em;\n  line-height: 1.2em;\n  font-size: 1.6em;/*px*/\n  text-align: center;\n\n  color: #ffffff;\n}\n",document.head.appendChild(m)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),m=Math.max(0,16-(n-e)),a=window.setTimeout(function(){t(n+m)},m);return e=n+m,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var m=function e(t,n,m,a,r,o,i){var f=t[n],s=m-f,l=new Date,u=this,c=r||function(e){return e};this.tickID=null,function e(){var r=new Date-l;if(r>=a)return t[n]=m,i&&i(m),o&&o(m),cancelAnimationFrame(u.tickID),void(u.toTick=null);t[n]=s*c(r/a)+f,u.tickID=requestAnimationFrame(e),i&&i(t[n])}(),e.List.push(this)};m.List=[],m.stopAll=function(){for(var e=0,t=m.List.length;e<t;e++)cancelAnimationFrame(m.List[e].tickID);m.List.length=0},m.stop=function(e){cancelAnimationFrame(e.tickID)},t.default=m},function(e,t,n){"use strict";function m(e){return"object"===("undefined"==typeof HTMLElement?"undefined":f(HTMLElement))?e instanceof HTMLElement:e&&"object"===(void 0===e?"undefined":f(e))&&1===e.nodeType&&"string"==typeof e.nodeName}function a(e,t){if("object"===(void 0===t?"undefined":f(t)))for(var n in t)e.style[n]=t[n]}function r(e){var t=this,n=document.createElement("img");return n.addEventListener("load",function(e){t.AFTER_HOOK&&t.AFTER_HOOK(null,n),t.AFTER_HOOK=null}),n.addEventListener("error",function(e){var m=new Error("图片加载失败");t.AFTER_HOOK&&t.AFTER_HOOK(m,n),t.AFTER_HOOK=null}),n.src=e,n.complete&&(this.AFTER_HOOK&&this.AFTER_HOOK(null,n),this.AFTER_HOOK=null),this}function o(e,t,n){var r=document.createElement(e);return t&&a(r,t),n&&m(n)&&r.appendChild(n),r}function i(e){return Math.sqrt(1-Math.pow(e-1,2))}Object.defineProperty(t,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.prototype.after=function(e){this.AFTER_HOOK=e},t.isDom=m,t.setStyle=a,t.pullImage=r,t.createElement=o,t.ease=i},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.util=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var m=t[n];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(e,m.key,m)}}return function(t,n,m){return n&&e(t.prototype,n),m&&e(t,m),t}}(),f=n(4),s=a(f),l=n(5),u=a(l),c=n(3),b=m(c),d=n(2),g=a(d),h=n(0),p=m(h);n(1),t.util=b;var w=function(){function e(t,n){r(this,e),b.isDom(t)&&(this.options="object"===(void 0===n?"undefined":o(n))?n:{},this.context=t,this.conBox=t.getBoundingClientRect(),this.callList=[],b.setStyle(this.context,{position:"relative",overflow:"hidden"}))}return i(e,[{key:"start",value:function(){var e=this;if(this.element)return void this.bind();this._loading("start"),new b.pullImage(this.options.imageSrc).after(function(t,n){if(e._loading("end"),t)return void e._err();for(e._init(n);e.callList.length;)e.callList.shift()()})}},{key:"_init",value:function(e){if(e){var t=p.judgeShape(e.width,e.height),n=p.transformWH(this.context.clientWidth,this.context.clientHeight,e.width,e.height,t),m=n.w,a=n.h,r=t===-1?0:this.context.clientHeight/2-a/2,o=1===t?0:this.context.clientWidth/2-m/2;b.setStyle(e,{position:"absolute",width:m+"px",height:a+"px",top:r+"px",left:o+"px"}),this.element=e,this.elBox=this.element.getBoundingClientRect(),this.leftPx=o,this.topPx=r,(0,u.default)(this.element),this.bind()}}},{key:"_loading",value:function(e){"start"===e&&(this.loadingDom||(this.loadingDom=document.createElement("div"),this.loadingDom.className="loader"),this.context.appendChild(this.loadingDom)),"end"===e&&this.context.removeChild(this.loadingDom)}},{key:"_err",value:function(){this.errDom||(this.errDom=document.createElement("p"),this.errDom.className="pr__load--err",this.errDom.innerHTML="图片加载失败"),this.context.appendChild(this.errDom)}},{key:"bind",value:function(){var e=this;if(!this.element)return void this.callList.push(function(){e.bind()});this.gesture&&this.unbind();var t=this.element,n=this.options.minZoom,m=this.options.maxZoom,a=this.elBox,r=this.conBox,o=this,i=this.leftPx,f=this.topPx,l=b.ease,u=1,c=!1;this.gesture=new s.default(this.context,{multipointStart:function(){g.default.stopAll(),u=t.scaleX},pinch:function(e){t.scaleX=t.scaleY=u*e.scale},multipointEnd:function(){t.scaleX<n&&(new g.default(t,"scaleX",n,500,l),new g.default(t,"scaleY",n,500,l)),t.scaleX>m&&(new g.default(t,"scaleX",m,500,l),new g.default(t,"scaleY",m,500,l))},pressMove:function(e){g.default.stopAll(),c=!0;var n=o.options.softX,m=o.options.softY;if(n)t.translateX+=e.deltaX,o.moveX=!0;else{p.checkPlace(a.width,r.width,i,t.translateX+e.deltaX,t.scaleX)===!1?(t.translateX+=e.deltaX,o.moveX=!0):o.moveX=!1}if(m)t.translateY+=e.deltaY,o.moveY=!0;else{p.checkPlace(a.height,r.height,f,t.translateY+e.deltaY,t.scaleY)===!1?(t.translateY+=e.deltaY,o.moveY=!0):o.moveY=!1}e.preventDefault()},touchEnd:function(){if(c){var e=p.checkPlace(a.height,r.height,f,t.translateY,t.scaleY),n=p.checkPlace(a.width,r.width,i,t.translateX,t.scaleX);e!==!1&&new g.default(t,"translateY",e,400,l),n!==!1&&new g.default(t,"translateX",n,400,l)}c=!1},doubleTap:function(e){g.default.stopAll();var m=o.options.doubleZoom,s=(n+m)/2,u=400;if(t.scaleX>s)new g.default(t,"scaleX",n,u,l),new g.default(t,"scaleY",n,u,l),new g.default(t,"translateX",0,u,l),new g.default(t,"translateY",0,u,l);else{var c=r.width/2,b=r.height/2,d=[e.changedTouches[0].pageX,e.changedTouches[0].pageY],h=d[0],w=d[1],v=p.calculateOffset(c,h,i,a.width,r.width,m),y=p.calculateOffset(b,w,f,a.height,r.height,m);new g.default(t,"scaleX",m,u,l),new g.default(t,"scaleY",m,u,l),new g.default(t,"translateX",v,u,l),new g.default(t,"translateY",y,u,l)}}})}},{key:"unbind",value:function(){var e=this;if(!this.element)return void this.callList.push(function(){e.unbind()});this.gesture=this.gesture&&this.gesture.destroy()}},{key:"reset",value:function(e){var t=e||0,n=this.element,m=b.ease;this.element&&(new g.default(n,"scaleX",this.options.minZoom,t,m),new g.default(n,"scaleY",this.options.minZoom,t,m),new g.default(n,"translateX",0,t,m),new g.default(n,"translateY",0,t,m))}},{key:"options",get:function(){return this._options},set:function(e){this._options={imageSrc:"",doubleZoom:2,maxZoom:4,minZoom:1,softX:!0,softY:!0};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(this._options[t]=e[t])}},{key:"element",get:function(){return this._element},set:function(e){this._element||(this._element=e,this.context.appendChild(this.element))}}]),e}();t.default=w}])});